---
title: 프로세스 API
date: 2024-11-20 17:00:00 +09:00
categories: [OS, Virtualization]
tags:
  [operating system, ostep, process api]
---
> 아래의 api는 Unix 시스템의 프로세스 API입니다.
{: .prompt-info }


## **fork() 시스템 콜**

`fork()`는 UNIX 기반 시스템에서 사용되는 시스템 호출로, 현재 실행 중인 프로세스를 복사하여 새로운 프로세스를 생성한다. 이때 생성된 프로세스를 **자식 프로세스**라고 부르며, 원래의 프로세스는 **부모 프로세스**로 간주된다.

### **fork()의 동작 방식**

1. **독립적인 주소 공간 생성**  
   `fork()` 호출 시 자식 프로세스는 부모 프로세스의 주소 공간을 복사한다.  
   하지만 자식과 부모는 별도의 독립적인 주소 공간을 가지며, 서로의 데이터를 공유하지 않는다.  
   (물리 메모리는 **Copy-on-Write**를 통해 효율적으로 관리된다.)

2. **레지스터와 프로그램 카운터(PC) 값 복사**  
   자식 프로세스는 부모 프로세스의 실행 상태를 그대로 복사한다.  
   이때, 자식 프로세스는 복사된 시점의 레지스터 및 프로그램 카운터(PC) 값을 물려받아 그 시점의 코드부터 실행된다.

3. **fork() 반환값 차이**  
   `fork()`는 부모와 자식 프로세스에서 서로 다른 값을 반환한다.
   - 부모 프로세스: **자식 프로세스의 PID**(Process ID)가 반환된다.
   - 자식 프로세스: **`0`**이 반환된다.

   이 반환값의 차이를 이용하여 부모와 자식이 서로 다른 코드 경로를 실행하도록 프로그래밍할 수 있다.

![alt text](/assets/img/OS/ProcessAPI/image.png)
_fork api를 이용한 프로세스 생성 예제 코드_

![alt text](/assets/img/OS/ProcessAPI/image-1.png)
_fork() 함수에 대한 리턴값이 부모와 자식 프로세스가 서로 달라 다른 문자열을 출력하는 모습_

![alt text](/assets/img/OS/ProcessAPI/image-2.png)
_자식 프로세스와 부모 프로세스간의 실행 순서는 CPU 스케줄러에 따라 결정되므로 프로그램을 시작할 때 마다 출력이 다르다_

## **wait() 시스템 콜**

`wait()` 시스템 콜은 부모 프로세스가 자식 프로세스의 종료를 대기해야 할 때 사용한다.  
이 호출은 부모 프로세스가 자식 프로세스의 종료 상태를 수집하고, 종료될 때까지 자신의 실행을 잠시 중지시킨다.  

### **동작 원리**

1. 부모 프로세스가 `wait()`를 호출하면, 실행이 일시적으로 중단된다.  
2. 자식 프로세스가 종료되면, 부모 프로세스는 `wait()` 호출에서 깨어나고, 자식 프로세스의 종료 상태를 반환받는다.  
3. 자식 프로세스가 이미 종료된 상태라면, 부모 프로세스는 즉시 반환 값을 받는다.

![alt text](/assets/img/OS/ProcessAPI/image-3.png)

- 부모 프로세스는 자식 프로세스가 종료될 때까지 대기한다.  
- 자식 프로세스가 종료되면, `wait()` 호출은 반환되고 부모 프로세스의 실행이 재개된다.

![alt text](/assets/img/OS/ProcessAPI/image-4.png)
_`wait()`를 사용했을 때 프로그램이 항상 동일한 결과를 출력하는 모습_

## **exec() 시스템 콜**

`exec()` 시스템 콜은 프로세스가 자기 자신이 아닌 **다른 프로그램**을 실행할 때 사용하는 시스템 호출이다.

### **동작 원리**

1. `exec()`는 실행 파일의 이름과 인자를 받아들인다.
2. 해당 실행 파일의 **코드**와 **정적 데이터**를 읽어 들인 후, 현재 실행 중인 프로세스의 코드 세그먼트와 정적 데이터 부분을 덮어쓴다.
3. 기존 프로세스의 **힙**과 **스택**, **주소 공간**은 새로운 프로그램의 실행을 위해 다시 초기화된다.
4. 새로운 실행 파일이 로드되면, 기존 프로세스는 사라지고 해당 실행 파일로 대체된다.

### **특징**

- `exec()`는 **새로운 프로세스를 생성하지 않는다**.  
  대신 현재 프로세스를 다른 프로그램으로 완전히 대체한다.
- 호출 이후, 기존의 코드 실행은 중단되고 대체된 프로그램의 **엔트리 포인트(보통 `main()` 함수)**부터 실행된다.
- 동일한 PID를 유지하며, 프로세스 자체가 대체된 프로그램으로 변환된다.

![alt text](/assets/img/OS/ProcessAPI/image-5.png)
_fork를 이용해 자식 프로세스를 만들고 자식 프로세스는 wc라는 프로그램을 실행하게 된다_

![alt text](/assets/img/OS/ProcessAPI/image-6.png)
_자식 프로세스(p3.c)의 경우 중간에 다른 프로그램(wc)으로 변경되어 마지막 줄의 출력을 하지 않는다_

