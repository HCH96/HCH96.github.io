---
title: 비례 배분 스케줄링(Proportional Share)
date: 2024-11-23 02:00:00 +09:00
categories: [OS, Virtualization]
tags:
  [operating system, ostep, scheduling]
---

비례 배분 스케줄러(Proportional Share) 스케줄러는 반환 시간이나 응답 시간을 최적화하기보다는 각 작업에 CPU의 일정 비율을 보장하는 것을 목적으로 한다.

---

## **추첨 스케줄링(Lottery Scheduling)**

추첨 스케줄링은 "추첨권"이라는 개념을 기반으로 자원을 할당하는 스케줄링 기법이다. 각 프로세스가 소유한 추첨권의 수와 전체 추첨권 수의 비율이 해당 프로세스가 받을 자원의 비율을 나타낸다. 스케줄러는 타임 슬라이스가 끝날 때마다 임의의 추첨권을 선택하여 그 추첨권을 소유한 프로세스에게 CPU를 할당한다.

### **예시**
프로세스 A와 B가 각각 75장과 25장의 추첨권을 소유하고 있다고 가정한다.  
- A는 전체 추첨권의 75%를 차지하므로, CPU를 사용할 확률이 75%이다.
- B는 나머지 25%의 확률로 CPU를 차지한다.

#### **추첨권 선택 순서**
`63, 85, 70, 39, 76, 17, 29, 41, ...`

#### **스케줄링 결과**
`A, B, A, A, B, A, A, A, A, A, ...`

무작위성으로 인해 단기적으로는 정확한 비율을 보장하지 않지만, 장기적으로는 A와 B가 75:25의 비율에 근접하게 자원을 할당받는다.

> ![alt text](/assets/img/OS/Proportional%20Share/image.png){: style="width: 70%; display: block; margin: 0 auto;" }
_불공정 지표_
작업 길이가 늘어날수록 공정해지는 모습을 볼 수 있다.
{: .prompt-tip }

---

## **추첨 기법**

### **추첨권 화폐(Ticket Currency)**
사용자가 추첨권을 자신의 기준 화폐 단위로 할당할 수 있도록 하며, 시스템은 이를 전역 기준으로 변환한다.  
#### **예시**
- 사용자 A와 B가 각각 100장의 추첨권을 받았다.
- 사용자 A는 두 작업 A1, A2를 실행하며, 각각 500장의 추첨권을 자신의 기준으로 할당했다.
- 사용자 B는 작업 B1에 10장의 추첨권을 할당했다.

이를 전역 기준으로 변환하면:
- A1, A2는 각각 50장씩 전역 기준 추첨권을 가진다.
- B1은 100장의 전역 기준 추첨권을 가진다.

### **추첨권 양도(Ticket Transfer)**
작업 간에 추첨권을 일시적으로 양도할 수 있다.  
- 클라이언트-서버 환경에서 유용하다.  
- 클라이언트가 서버에게 작업을 요청할 때, 작업이 빨리 완료되도록 자신의 추첨권을 서버에 전달한다.  
- 작업 완료 후 서버는 추첨권을 클라이언트에게 반환한다.

### **추첨권 팽창(Ticket Inflation)**
프로세스가 자신이 소유한 추첨권의 수를 일시적으로 늘리거나 줄일 수 있다.  
- 신뢰 환경에서 유용하다.  
- 더 많은 CPU 자원을 필요로 하는 작업은 스스로 추첨권 수를 늘려 우선순위를 높일 수 있다.  
- 비신뢰 환경에서는 남용 가능성이 있어 적합하지 않다.

---

## **보폭 스케줄링(Stride Scheduling)**

보폭 스케줄링은 추첨 스케줄링과 달리 각 작업에 대해 정확한 비율로 자원을 배분하는 기법이다.  
작업은 각기 다른 보폭 값을 가지며, 이는 작업의 추첨권 수에 반비례한다.  

### **보폭 계산**
보폭은 다음 공식을 통해 계산된다:
보폭 = 임의의 큰 값 ÷ 추첨권 수


#### **예시**
![alt text](/assets/img/OS/Proportional%20Share/image-1.png)
_보폭 스케줄링_

- 작업 A, B, C의 추첨권 수가 각각 100, 50, 250이라면:
  - A의 보폭: 10,000 ÷ 100 = 100
  - B의 보폭: 10,000 ÷ 50 = 200
  - C의 보폭: 10,000 ÷ 250 = 40

작업이 스케줄링될 때마다 `pass` 값을 보폭만큼 증가시키고, 스케줄러는 가장 작은 `pass` 값을 가진 작업을 선택한다.

### **특징**
- 매 스케줄링 주기마다 정확한 비율로 자원을 배분한다.
- 추첨 스케줄링보다 더 예측 가능하며 공정한 배분을 제공한다.
- 하지만 각 작업의 상태 정보(`pass` 값)를 관리해야 하므로 구현 복잡도가 증가한다.

---

## **비교**

| **특징**           | **추첨 스케줄링**                     | **보폭 스케줄링**                 |
|------------------|----------------------------------|------------------------------|
| **정확성**         | 장기적으로 비율 수렴                     | 매 주기마다 정확한 비율 보장         |
| **복잡성**         | 상대적으로 간단                         | 상태 관리 필요, 복잡도 높음          |
| **무작위성**       | 무작위성 포함                          | 무작위성 없음                    |
| **적합한 환경**     | 비정기적 작업                          | 정기적, 예측 가능한 작업 환경         |

---

비례 배분 스케줄링은 시스템 요구 사항에 따라 추첨 스케줄링이나 보폭 스케줄링 중 적합한 방식을 선택하여 적용할 수 있다.
