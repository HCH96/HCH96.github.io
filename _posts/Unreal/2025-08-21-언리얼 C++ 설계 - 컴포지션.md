---
title: 언리얼 컴포지션
date: 2025-08-21 18:40:00 +09:00
categories: [Unreal, 언리얼 c++의 이해]
published: true
tags:
  [unreal, cpp, composition]
---

## **컴포지션**
상속 대신 액터에 여러 컴포넌트를 조합하여 기능을 확장하는 객체 지향 설계 방식이다. 이를 통해 유연하고 복잡한 기능을 가진 오브젝트를 효과적으로 설계할 수 있다.

### 컴포지션의 특징
1. Has-A 관계
  - 컴포지션은 **Is-A**관계 대신 **Has-A** 관계를 통해 객체를 구성한다. 

2. 유연한 기능 확장
  - 각 컴포넌트는 특정 기능을 담당하며, 이를 필요에 따라 액터에 추가하거나 제거하여 기능을 유연하게 조합할 수 있다.

3. 반복적인 기능 재사용
  - 특정 기능을 가진 컴포넌트를 여러 액터에서 재사용하여 코드의 중복을 줄이고 유지보수성을 높일 수 있다.

4. 복잡적인 오브젝트 설계
  - 거대한 클래스를 하나의 거대한 상속 계층으로 만드는 대신, 여러 개의 작은 컴포넌트를 조합하여 복합적인 기능을 가진 오브젝트를 효과적으로 설계할 수 있다.


## **언리얼에서의 컴포지션 구현 방법**
언리얼 오브젝트에는 항상 기본 오브젝트인 COD가 존재한다. 이 오브젝트가 컴포넌트 오브젝트를 가지고 있을 때, CDO에 컴포넌트 오브젝트의 포함 여부에 따라 방식이 다르다.

```cpp

UCLASS()
class UNREALSTUDY_API UPerson : public UObject
{
	GENERATED_BODY()
	
public:
	UPerson();

	FORCEINLINE const FString& GetName() const { return Name; }
	FORCEINLINE void SetName(const FString& InName) { Name = InName; }

	FORCEINLINE class UCard* GetCard() const { return Card; }
	FORCEINLINE void SetCard(class UCard* InCard) { Card = InCard; }

protected:
	UPROPERTY()
	FString Name;

	UPROPERTY()
	TObjectPtr<class UCard> Card;

};
```

> 언리얼은 더 이상 32비트를 지원하지 않는다. UPROPERTY() 변수를 사용할 경우 TObjectPtr<> 템플릿 클래스로 감싸 64비트를 보장하도록 해야한다.
{: .prompt-tip }


### CDO에 미리 컴포넌트 오브젝트를 생성해 조합(필수적 포함)

```cpp

#include "Person.h"
#include "Card.h"

UPerson::UPerson()
{
	Name = TEXT("홍길동");
	Card = CreateDefaultSubobject<UCard>(TEXT("NAME_Card"));
}
```

- CreateDefaultSubobject<>() 함수를 통해 생성자에서 컴포넌트를 추가한다.

> 인자로 FName을 받는 이유  
CreateDefaultSubobject<>()의 첫 번째 인자로 들어가는 FName은 컴포넌트를 구분하기 위한 식별자이다. 엔진은 CDO 안에 있는 **여러 서브오브젝트(컴포넌트)**들을 하나의 컨테이너(Map/Array) 안에 관리하고 각 SubObject는 `FName`키로 식별된다. 이런 이유 때문에 같은 CDO안에서 동일한 식별자를 사용할 수 없다.
{: .prompt-tip }

### COD에 빈 포인터만 넣고 런타임에 언리얼 오브젝트를 생성해 조합(선택적 포함)

```cpp
#include "Person.h"
#include "Card.h"

UPerson::UPerson()
{
	Name = TEXT("홍길동");
	Card = nullptr;
}

UPerson::AddCard()
{
  if(!Card)
  {
    Card = NewObject<UCard>(this,TEXT("NAME_Card_Runtime"));
  }
}
```

### 필수/선택 차이
- 필수적 포함(CDO 생성): 오브젝트가 항상 가져야 하는 핵심 기능일 경우.
- 선택적 포함(런타임 생성): 상황에 따라 붙었다 떨어졌다 해야 하는 부가 기능일 경우.


