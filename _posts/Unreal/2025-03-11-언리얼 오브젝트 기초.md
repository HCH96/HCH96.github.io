---
title: 언리얼 오브젝트 기초
date: 2025-03-11 03:50:00 +09:00
categories: [Unreal, 언리얼 c++의 이해]
published: true
tags:
  [unreal, cpp]
---

## 기존 언어의 특징과 게임 프로그래밍의 특수성
### C++언어와 하이레벨 OOP언어(C#, Java)의 특징

- C++ (안정성보다 성능중시)
    - 메모리를 직접 제어
    - Cache의 활용 극대화
    - 저수준 API의 직접 호출
    - 복사 작업의 최소화

- 하이레벨 OOP언어 (성능보다 안정성중시)
    - 유지보수성 향상
    - 크래시로부터 보호
    - 자동 메모리 관리
    - 고질적 실수 예방


### 게임 프로그래밍의 특수성
- 사용자: 쾌적한 경험을 위해 단일 컴퓨터에서 최대 성능을 뽑아내야 한다.
- 개발자: 게임의 규모가 커질수록 방대하고 복잡한 기능을 안정적으로 관리해야 한다.

---

## 언리얼 엔진
- 게임 규모가 커짐에 따라 성능과 유지보수가 중요한 요소가 됨.
- 언리얼 엔진은 C++을 확장하여 "언리얼 오브젝트(UObject)"라는 객체 구조를 도입.
- UCLASS, USTRUCT, UFUNCTION, UPROPERTY 등의 지정된 매크로를 사용하여 객체를 정의.
- 빌드 과정에서 UnrealHeaderTool(UHT) 이 추가적인 코드를 자동 생성하여 엔진에서 활용 가능하게 함.
- 이를 통해 대규모 게임을 효율적이고 안정적으로 개발할 수 있도록 지원.

### **언리얼 오브젝트**
언리얼 엔진이 설계한 새로운 시스템의 단위 오브젝트로, 기존 C++ 오브젝트에 모던 객체 지향 설계를 위한 다양한 기능을 추가하였다. 

- 일반 C++ 오브젝트와 언리얼 오브젝트 두 객체를 모두 사용할 수 있다.
- 구분을 위해 일반 C++ 오브젝트는 F, 언리얼 오브젝트는 접두사 U를 사용한다.

#### 각 오브젝트의 사용 용도
- C++ 오브젝트: 저수준의 빠른 처리를 위한 기능 구현에 사용
- 언리얼 오브젝트: 콘텐츠 제작에 관련된 복잡한 설계 구현에 사용

#### 언리얼 오브젝트를 통해 제공되는 기능
- 가비지 컬렉션
- 레퍼런스 업데이트
- 리플렉션
- 직렬화
- 디폴트 프로퍼티 변경사항의 자동 업데이트
- 자동 프로퍼티 초기화
- 자동 에디터 통합
- 런타임에 사용 가능한 타입 정보
- 네트워크 리플리케이션

#### UCLASS 매크로
UCLASS 매크로는 언리얼 엔진의 UObject 기반 클래스를 정의할 때 사용되며, 해당 클래스의 메타데이터와 동작을 엔진에 제공하는 역할을 한다.

- **언리얼 오브젝트 시스템(UObject 시스템)**에서 사용되는 클래스를 정의하는 매크로.
- 엔진이 클래스를 인식하고, 반사(reflection) 시스템을 통해 정보를 제공할 수 있도록 함.
- 주로 UObject를 상속받는 클래스에서 사용됨.

```cpp
UCLASS()
class MYGAME_API UMyClass : public UObject
{
    GENERATED_BODY()
};
```

##### 클래스 디폴트 오브젝트 (CDO)
- 모든 UCLASS 객체는 클래스 디폴트 오브젝트(Class Default Object, CDO) 를 가짐.
- CDO는 클래스의 템플릿 역할을 하는 기본 인스턴스로, 생성자에서 초기화된 상태 그대로 유지됨.
- CDO는 읽기 전용으로 간주되며, 새로운 인스턴스를 생성할 때 기본값을 제공.

##### UCLASS와 객체 인스턴스
- UCLASS는 오브젝트를 설명하는 메타데이터를 포함하며, 오브젝트 인스턴스에서 언제든지 접근 가능.
- GetClass() 함수를 통해 오브젝트가 속한 UClass 정보를 얻을 수 있음.

##### UCLASS의 역할
- 언리얼 엔진의 리플렉션 시스템(Reflection System)에 클래스 등록
- 프로퍼티와 함수 태그 지정(메타데이터 제공)
- 가비지 컬렉션(GC) 지원
- 네트워크 리플리케이션(Replication) 지원
- 에디터 내에서 클래스 사용 가능(블루프린트 등)

#### Object의 생성
- UObject는 생성자 실행인자를 지원하지 않는다. 모든 C++ UObeject는 엔진 시작 시 초기화되며, 엔진은 디폴트 생성자를 호출한다.
- UObject 생성자는 가벼워야 하고 디폴트값과 서브오브젝트를 구성하는 데에만 사용되어야 하며, 생성 시 다른 함수 기능을 호출해서는 안 된다.
-  액터 및 액터 컴포넌트의 경우, 대신에 초기화 함수 기능을 BeginPlay() 메서드에 넣어야 한다.
- UObject는 런타임에 NewObject를 사용하거나 생성자의 경우 CreateDefaultSubobject를 사용하여 생성해야 한다.

> UObject는 new 연산자를 사용하면 안 된다. 모든 UObject는 언리얼 엔진으로 관리되는 메모리이며 가비지 컬렉션된다. new 또는 delete를 사용하여 메모리를 수동으로 관리하면 메모리가 손상될 수 있다.
{: .prompt-warning }

### **언리얼 헤더 툴(UHT)**
UnrealHeaderTool (UHT) 은 UObject 기반 클래스가 제공하는 기능을 활용할 수 있도록 헤더 파일을 전처리하여 필요한 정보를 생성하는 도구이다. UObject를 상속받는 모든 클래스는 UHT가 요구하는 특정 구조를 따라야 하며, 올바른 헤더 파일 포맷을 유지해야 한다.

- UObject 기반 클래스를 언리얼 엔진의 리플렉션 시스템에 등록하기 위해 필요한 코드를 자동 생성하는 툴.

- UCLASS, USTRUCT, UENUM, UPROPERTY, UFUNCTION 등의 매크로를 처리하고, 에디터, 네트워크, 블루프린트 시스템에서 사용 가능하도록 메타데이터를 추가함.

#### 헤더 파일 포맷
UHT가 올바르게 작동하려면 특정한 구조를 따라야 한다.

```cpp
#pragma once

#include "CoreMinimal.h"  // 기본적인 언리얼 엔진 헤더 포함
#include "UObject/Object.h"
#include "MyObject.generated.h"  // 🔥 UHT가 자동 생성하는 코드 포함

UCLASS()
class MYPROJECT_API UMyObject : public UObject
{
    GENERATED_BODY()  // 🔥 UHT가 필요한 기본 코드 자동 생성
};

```

#### 주요 언리얼 헤더 요소

`#include "MyObject.generated.h"`
- 반드시 헤더 파일의 마지막 #include 문으로 배치해야 한다.
- UHT가 UObject 클래스에 필요한 자동 생성 코드를 포함시키는 역할을 한다.

`UCLASS() 매크로`
- UObject 기반 클래스를 언리얼 엔진에서 인식 가능하도록 등록하는 매크로.
- UCLASS 안에 다양한 클래스 지정자(Class Specifier) 를 넣어 추가 기능을 활성화할 수 있다.

`GENERATED_BODY() 매크로`
- UCLASS, USTRUCT에서 반드시 포함해야 하는 매크로.
- UHT가 이 클래스에 필요한 내부 코드를 자동 생성한다.
- GENERATED_UCLASS_BODY()는 구버전(UE4)에서 사용되었지만, 현재는 GENERATED_BODY()를 사용한다.

`MYPROJECT_API의 역할`

- MYPROJECT_API는 이 클래스를 다른 모듈에서 사용할 수 있도록 내보내는 역할을 한다.
- 다른 모듈(플러그인, 엔진 코드 등)에서 이 클래스를 사용할 수 있도록 심볼(export)을 공개해야 할 때 필요하다.
